<!-- TIR Calculator -->
<div id="tir-calculator" class="simulation-calculator" style="display: none;">
  <!-- Chart.js for TIR sensitivity analysis -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <div class="bg-white rounded-2xl shadow-xl p-8">
    <!-- Header with Engineering Economics Context -->
    <div class="flex items-start justify-between mb-6">
      <div class="flex-1">
        <div class="flex items-center gap-3 mb-2">
          <h3 class="text-2xl font-bold text-gray-800">Tasa Interna de Retorno (TIR)</h3>
          <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
            <i class="fas fa-star mr-1"></i>Método Estándar
          </div>
        </div>
        <p class="text-gray-600 mb-3">Métrica de rentabilidad que iguala el VAN a cero</p>

        <!-- Educational Content -->
        <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-4">
          <div class="flex items-start">
            <i class="fas fa-graduation-cap text-green-600 mt-1 mr-3"></i>
            <div>
              <h5 class="font-semibold text-green-800 mb-1">Concepto Económico</h5>
              <p class="text-sm text-green-700">
                La TIR es la tasa de descuento que hace que el VAN sea exactamente cero. Representa la tasa de rentabilidad
                real del proyecto, permitiendo comparar inversiones con diferentes escalas y horizontes temporales.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <form id="tir-form" class="space-y-6">
      <!-- Project Context -->
      <div class="bg-gray-50 p-4 rounded-lg mb-6">
        <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
          <i class="fas fa-project-diagram mr-2 text-gray-600"></i>
          Contexto del Proyecto
        </h4>
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Nombre del Proyecto
            </label>
            <input
              type="text"
              id="tir-nombre-proyecto"
              name="nombre_proyecto"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
              placeholder="Ej: Expansión Planta Industrial"
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Método de Cálculo
            </label>
            <select id="tir-metodo" name="metodo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
              <option value="newton">Newton-Raphson (Recomendado)</option>
              <option value="biseccion">Bisección</option>
              <option value="aproximacion">Aproximación Simple</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Investment Details -->
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
            <i class="fas fa-dollar-sign mr-2 text-gray-500"></i>
            Inversión Inicial (S/)
          </label>
          <input
            type="number"
            id="tir-inversion"
            name="inversion"
            required
            min="0"
            step="0.01"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
          >
          <p class="text-xs text-gray-500 mt-1">Costo total de la inversión inicial (valor negativo)</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
            <i class="fas fa-percentage mr-2 text-gray-500"></i>
            Tasa de Referencia (%)
          </label>
          <input
            type="number"
            id="tir-tasa-referencia"
            name="tasa_referencia"
            required
            min="0"
            max="100"
            step="0.01"
            value="12"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
            placeholder="12"
          >
          <p class="text-xs text-gray-500 mt-1">Tasa para calcular VAN comparativo (WACC, costo de oportunidad, etc.)</p>
        </div>
      </div>

      <!-- Cash Flows -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-3 flex items-center">
          <i class="fas fa-chart-line mr-2 text-gray-500"></i>
          Flujos de Caja Operativos (S/)
        </label>
        <p class="text-xs text-gray-600 mb-3">Ingresos menos costos operativos, depreciación e impuestos</p>

        <div id="tir-flujos" class="space-y-3">
          <div class="flex items-center space-x-3">
            <span class="text-sm text-gray-600 w-16 font-medium">Año 1:</span>
            <input
              type="number"
              name="flujo1"
              step="0.01"
              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
              placeholder="250000"
            >
            <button type="button" class="remover-anio text-red-500 hover:text-red-700 px-2 opacity-0" style="display: none;">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="flex items-center space-x-3">
            <span class="text-sm text-gray-600 w-16 font-medium">Año 2:</span>
            <input
              type="number"
              name="flujo2"
              step="0.01"
              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
              placeholder="280000"
            >
            <button type="button" class="remover-anio text-red-500 hover:text-red-700 px-2 opacity-0" style="display: none;">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="flex items-center space-x-3">
            <span class="text-sm text-gray-600 w-16 font-medium">Año 3:</span>
            <input
              type="number"
              name="flujo3"
              step="0.01"
              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
              placeholder="320000"
            >
            <button type="button" class="remover-anio text-red-500 hover:text-red-700 px-2 opacity-0">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>

        <button
          type="button"
          id="add-flujo-tir"
          class="mt-3 text-green-600 hover:text-green-800 text-sm font-medium flex items-center"
        >
          <i class="fas fa-plus mr-1"></i>Agregar período adicional
        </button>
      </div>

      <!-- Analysis Options -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
          <i class="fas fa-cogs mr-2 text-gray-600"></i>
          Opciones de Análisis
        </h4>
        <div class="grid md:grid-cols-2 gap-4">
          <div class="flex items-center">
            <input type="checkbox" id="tir-convergencia" name="mostrar_convergencia" class="mr-2">
            <label for="tir-convergencia" class="text-sm text-gray-700">Mostrar proceso de convergencia</label>
          </div>
          <div class="flex items-center">
            <input type="checkbox" id="tir-sensibilidad" name="analisis_sensibilidad" class="mr-2">
            <label for="tir-sensibilidad" class="text-sm text-gray-700">Análisis de sensibilidad</label>
          </div>
        </div>
      </div>

      <!-- Calculate Button -->
      <div class="flex justify-center pt-4">
        <button
          type="submit"
          class="bg-gradient-to-r from-green-600 to-green-700 text-white px-10 py-4 rounded-lg hover:from-green-700 hover:to-green-800 focus:ring-4 focus:ring-green-300 transition duration-300 text-lg font-semibold shadow-lg"
        >
          <i class="fas fa-calculator mr-2"></i>Calcular TIR y Análisis
        </button>
      </div>
    </form>

    <!-- Results Section -->
    <div id="tir-results" class="mt-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200" style="display: none;">
      <div class="flex items-center justify-between mb-6">
        <h4 class="text-xl font-bold text-gray-800">Resultados del Análisis TIR</h4>
        <div class="flex gap-2">
          <button class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100" title="Exportar PDF">
            <i class="fas fa-file-pdf"></i>
          </button>
          <button class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100" title="Exportar Excel">
            <i class="fas fa-file-excel"></i>
          </button>
        </div>
      </div>

      <!-- Main Metrics -->
      <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 text-center">
          <div class="text-2xl font-bold text-green-600 mb-1" id="tir-result">0.0%</div>
          <div class="text-sm text-gray-600 font-medium">Tasa Interna de Retorno</div>
          <div class="text-xs text-gray-500 mt-1">TIR</div>
        </div>

        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 text-center">
          <div class="text-2xl font-bold text-blue-600 mb-1" id="tir-vpn-tir">S/ 0</div>
          <div class="text-sm text-gray-600 font-medium">VAN a la TIR</div>
          <div class="text-xs text-gray-500 mt-1">Verificación</div>
        </div>

        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 text-center">
          <div class="text-2xl font-bold text-purple-600 mb-1" id="tir-iteraciones">0</div>
          <div class="text-sm text-gray-600 font-medium">Iteraciones</div>
          <div class="text-xs text-gray-500 mt-1">Convergencia</div>
        </div>
      </div>

      <!-- Decision Framework -->
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6">
        <h5 class="font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-gavel mr-2 text-gray-600"></i>
          Marco de Decisión Económica
        </h5>

        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <div class="flex items-center justify-between mb-2">
              <span class="font-medium text-gray-800">Evaluación:</span>
              <span id="tir-evaluation" class="px-3 py-1 rounded-full text-sm font-semibold"></span>
            </div>
            <div class="text-sm text-gray-600" id="tir-evaluation-text">
              Evaluando rentabilidad del proyecto...
            </div>
          </div>

          <div>
            <div class="flex items-center justify-between mb-2">
              <span class="font-medium text-gray-800">Comparación con WACC:</span>
              <span id="tir-vs-wacc" class="px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                Calcular WACC primero
              </span>
            </div>
            <div class="text-sm text-gray-600">
              TIR > WACC indica valor creado
            </div>
          </div>
        </div>
      </div>

      <!-- Convergence Analysis -->
      <div id="tir-convergence-section" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6" style="display: none;">
        <h5 class="font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-chart-line mr-2 text-gray-600"></i>
          Análisis de Convergencia
        </h5>

        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-2 text-left font-medium text-gray-700">Iteración</th>
                <th class="px-4 py-2 text-right font-medium text-gray-700">TIR (%)</th>
                <th class="px-4 py-2 text-right font-medium text-gray-700">VAN</th>
                <th class="px-4 py-2 text-right font-medium text-gray-700">Derivada</th>
              </tr>
            </thead>
            <tbody id="tir-convergence-table" class="divide-y divide-gray-200">
              <!-- Convergence data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Cash Flow Summary -->
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6">
        <h5 class="font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-table mr-2 text-gray-600"></i>
          Resumen de Flujos de Caja
        </h5>

        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h6 class="font-semibold text-gray-700 mb-3">Inversión Inicial</h6>
            <div class="text-2xl font-bold text-red-600" id="tir-inversion-summary">S/ 0</div>
          </div>
          <div>
            <h6 class="font-semibold text-gray-700 mb-3">Flujo Total de Caja</h6>
            <div class="text-2xl font-bold text-green-600" id="tir-flujo-total">S/ 0</div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-3 justify-center">
        <button class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-300 font-semibold flex items-center justify-center" onclick="window.simulacionFinanciera.guardarAnalisis('tir')">
          <i class="fas fa-save mr-2"></i>Guardar Análisis
        </button>
        <button id="tir-consultar-ia" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition duration-300 font-semibold flex items-center justify-center">
          <i class="fas fa-robot mr-2"></i>Consultar con IA
        </button>
      </div>
    </div>
  </div>
</div>
