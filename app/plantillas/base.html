<!DOCTYPE html>
<html lang="es" class="theme-light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Econova - Plataforma Inteligente de Simulación Financiera{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot_message_robot.css') }}">
    <style>
        /* Sistema de tipografía profesional */
        :root {
            --font-primary: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;--font-heading: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;--font-accent: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;--font-mono: 'JetBrains Mono', 'Fira Code', Consolas, monospace;/* Sistema de colores - serán definidos dinámicamente por JavaScript */
            --color-primary: #3b82f6;--color-secondary: #6b7280;--color-success: #10b981;--color-danger: #ef4444;--color-warning: #f59e0b;--color-background: #ffffff;--color-surface: #f9fafb;--color-text-primary: #111827;--color-text-secondary: #6b7280;--color-border: #d1d5db;--color-shadow: rgba(0, 0, 0, 0.1);--color-card-bg: #ffffff;--color-input-bg: #ffffff;}

        /* Tipografía jerárquica */
        .text-h1 {
            font-family: var(--font-heading);font-size: 2.5rem;font-weight: 700;line-height: 1.2;letter-spacing: -0.025em;}
        .text-h2 {
            font-family: var(--font-heading);font-size: 2rem;font-weight: 600;line-height: 1.3;letter-spacing: -0.025em;}
        .text-h3 {
            font-family: var(--font-heading);font-size: 1.5rem;font-weight: 600;line-height: 1.4;letter-spacing: -0.025em;}
        .text-h4 {
            font-family: var(--font-heading);font-size: 1.25rem;font-weight: 600;line-height: 1.4;letter-spacing: -0.025em;}
        .text-body-lg {
            font-family: var(--font-primary);font-size: 1.125rem;line-height: 1.6;font-weight: 400;}
        .text-body {
            font-family: var(--font-primary);font-size: 1rem;line-height: 1.6;font-weight: 400;}
        .text-sm {
            font-family: var(--font-primary);font-size: 0.875rem;line-height: 1.5;font-weight: 500;}
        .text-xs {
            font-family: var(--font-primary);font-size: 0.75rem;line-height: 1.4;font-weight: 500;}
        
        /* Énfasis en datos financieros */
        .text-data { font-family: var(--font-mono); font-weight: 600; font-size: 1.125rem; }
        .text-metric { font-family: var(--font-mono); font-weight: 700; font-size: 1.5rem; }
        
        /* Componentes UI profesionales */
        .card-elevated {
            background: var(--color-card-bg);border: 1px solid var(--color-border);border-radius: 12px;box-shadow: 0 4px 6px var(--color-shadow);transition: all 0.2s ease;}

        .card-elevated:hover {
            transform: translateY(-2px);box-shadow: 0 8px 15px var(--color-shadow);border-color: var(--color-primary);}

        .btn-primary {
            background-color: var(--color-primary);color: white;border: none;border-radius: 8px;padding: 12px 24px;font-weight: 600;font-size: 0.875rem;letter-spacing: 0.025em;transition: all 0.2s ease;text-transform: uppercase;}
        
        .btn-primary:hover {
            background-color: #1d4ed8;transform: translateY(-1px);box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);}
        
        .btn-secondary {
            background-color: white;color: var(--color-text-primary);border: 1px solid var(--color-border);border-radius: 8px;padding: 12px 24px;font-weight: 600;font-size: 0.875rem;letter-spacing: 0.025em;transition: all 0.2s ease;}
        
        .btn-secondary:hover {
            background-color: var(--color-surface);border-color: #cbd5e1;}

        /* Formularios profesionales */
        .form-input {
            width: 100%;padding: 12px 16px;border: 2px solid var(--color-border);border-radius: 8px;font-size: 1rem;font-family: var(--font-primary);transition: all 0.2s ease;background-color: white;}
        
        .form-input:focus {
            outline: none;border-color: var(--color-primary);box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);}
        
        .form-label {
            font-size: 0.875rem;font-weight: 600;color: var(--color-text-secondary);margin-bottom: 8px;display: block;}
        
        .form-group {
            margin-bottom: 20px;}

        /* Tablas financieras */
        .table-financial {
            width: 100%;border-collapse: separate;border-spacing: 0;background: white;border: 1px solid var(--color-border);border-radius: 12px;overflow: hidden;}
        
        .table-financial th {
            background-color: var(--color-surface);color: var(--color-text-secondary);font-weight: 600;font-size: 0.875rem;text-align: left;padding: 16px;border-bottom: 1px solid var(--color-border);text-transform: uppercase;letter-spacing: 0.05em;}
        
        .table-financial td {
            padding: 16px;border-bottom: 1px solid var(--color-border);font-size: 1rem;color: var(--color-text-primary);}
        
        .table-financial tr:hover {
            background-color: var(--color-surface);}
        
        .table-financial .metric-positive { color: var(--color-success); font-weight: 600; }
        .table-financial .metric-negative { color: var(--color-danger); font-weight: 600; }

        /* Métricas de resultados */
        .metric-card {
            background: var(--color-card-bg);border: 1px solid var(--color-border);border-radius: 12px;padding: 24px;text-align: center;transition: all 0.2s ease;}
        
        .metric-value {
            font-family: var(--font-mono);font-size: 2.5rem;font-weight: 700;line-height: 1;margin-bottom: 8px;}
        
        .metric-label {
            font-size: 0.875rem;color: var(--color-text-secondary);text-transform: uppercase;letter-spacing: 0.05em;font-weight: 600;}

        /* Chatbot integrado en página */
        .chatbot-container {
            background: var(--color-surface);border: 1px solid var(--color-border);border-radius: 16px;box-shadow: 0 4px 6px var(--color-shadow);overflow: hidden;transition: all 0.3s ease;}
        
        .chatbot-header {
            background: var(--color-primary);color: white;padding: 16px 20px;display: flex;align-items: center;gap: 12px;border-bottom: 1px solid var(--color-border);}
        
        .chatbot-avatar {
            width: 40px;height: 40px;border-radius: 50%;background: rgba(255, 255, 255, 0.2);display: flex;align-items: center;justify-content: center;font-size: 18px;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);}
        
        .chatbot-title {
            font-weight: 600;font-size: 16px;}
        
        .chatbot-status {
            font-size: 12px;opacity: 0.8;margin-left: auto;}
        
        .chatbot-messages {
            height: 400px;overflow-y: auto;padding: 20px;background: white;}
        
        .message {
            margin-bottom: 16px;animation: fadeIn 0.3s ease-out;}
        
        .message-user {
            text-align: right;}
        
        .message-content {
            display: inline-block;padding: 12px 16px;border-radius: 18px;max-width: 80%;line-height: 1.4;}
        
        .message-bot .message-content {
            background: var(--color-surface);color: var(--color-text-primary);border-top-left-radius: 4px;}
        
        .message-user .message-content {
            background: var(--color-primary);color: white;border-top-right-radius: 4px;}
        
        .message-avatar {
            width: 32px;height: 32px;border-radius: 50%;display: inline-flex;align-items: center;justify-content: center;margin-bottom: 6px;font-size: 14px;}
        
        .message-user .message-avatar {
            background: var(--color-primary);color: white;margin-left: auto;}
        
        .message-bot .message-avatar {
            background: rgba(37, 99, 235, 0.1);color: var(--color-primary);margin-right: 8px;}
        
        .chatbot-input-area {
            padding: 16px 20px;background: white;border-top: 1px solid var(--color-border);display: flex;gap: 12px;}
        
        .chatbot-input {
            flex: 1;padding: 12px 16px;border: 1px solid var(--color-border);border-radius: 24px;font-size: 14px;outline: none;transition: all 0.2s ease;}
        
        .chatbot-input:focus {
            border-color: var(--color-primary);box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);}
        
        .chatbot-send-btn {
            background: var(--color-primary);color: white;border: none;border-radius: 50%;width: 40px;height: 40px;display: flex;align-items: center;justify-content: center;cursor: pointer;transition: all 0.2s ease;}
        
        .chatbot-send-btn:hover {
            background: #1d4ed8;transform: scale(1.05);}
        
        .chatbot-send-btn:disabled {
            background: var(--color-border);cursor: not-allowed;transform: none;}
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Navegación profesional */
        .nav-bg {
            background-color: var(--color-card-bg);box-shadow: 0 4px 6px var(--color-shadow);}

        .nav-brand {
            color: var(--color-primary);font-size: 1.5rem;font-weight: 700;}

        .nav-link {
            color: var(--color-text-secondary);font-weight: 500;padding: 8px 16px;border-radius: 8px;transition: all 0.2s ease;}

        .nav-link:hover {
            color: var(--color-primary);background-color: var(--color-surface);}

        .nav-link.active {
            color: var(--color-primary);background-color: rgba(59, 130, 246, 0.1);font-weight: 600;}

        .nav-user-btn {
            display: flex;align-items: center;gap: 8px;color: var(--color-text-secondary);padding: 8px 12px;border-radius: 8px;transition: all 0.2s ease;}

        .nav-user-btn:hover {
            color: var(--color-primary);background-color: var(--color-surface);}

        .nav-user-avatar {
            width: 32px;height: 32px;border-radius: 50%;background-color: var(--color-primary);display: flex;align-items: center;justify-content: center;margin-right: 8px;}

        .nav-dropdown {
            position: absolute;right: 0;top: 100%;margin-top: 8px;width: 192px;background-color: var(--color-card-bg);border: 1px solid var(--color-border);border-radius: 8px;box-shadow: 0 4px 6px var(--color-shadow);padding: 8px 0;z-index: 99999;display: none;}

        .nav-dropdown-header {
            padding: 12px 16px;border-bottom: 1px solid var(--color-border);}

        .nav-dropdown-header p:first-child {
            color: var(--color-text-primary);font-weight: 600;}

        .nav-dropdown-header p:last-child {
            color: var(--color-text-secondary);font-size: 0.75rem;}

        .nav-dropdown-item {
            display: block;padding: 8px 16px;color: var(--color-text-secondary);text-decoration: none;font-size: 0.875rem;transition: all 0.2s ease;}

        .nav-dropdown-item:hover {
            color: var(--color-text-primary);background-color: var(--color-surface);}

        .nav-dropdown-danger:hover {
            color: var(--color-danger);background-color: rgba(239, 68, 68, 0.1);}

        .nav-dropdown-divider {
            border-top: 1px solid var(--color-border);margin: 4px 0;}

        .nav-theme-btn {
            margin-left: 16px;padding: 8px;background-color: var(--color-surface);border-radius: 8px;border: none;transition: all 0.2s ease;color: var(--color-warning);}

        .nav-theme-btn:hover {
            background-color: var(--color-border);}

        .nav-login-btn {
            padding: 12px 24px;border: 2px solid var(--color-primary);color: var(--color-primary);border-radius: 8px;text-decoration: none;transition: all 0.2s ease;}

        .nav-login-btn:hover {
            background-color: var(--color-primary);color: white;}

        .nav-register-btn {
            background-color: var(--color-primary);color: white;padding: 12px 24px;border-radius: 8px;text-decoration: none;transition: all 0.2s ease;}

        .nav-register-btn:hover {
            background-color: #1d4ed8;}

        .nav-mobile-btn {
            color: var(--color-text-secondary);padding: 8px;border-radius: 8px;transition: all 0.2s ease;}

        .nav-mobile-btn:hover {
            color: var(--color-primary);background-color: var(--color-surface);}

        /* Sistema de alertas */
        .alert-success {
            background-color: rgba(22, 163, 74, 0.1);border: 1px solid rgba(22, 163, 74, 0.3);color: #166534;border-radius: 8px;padding: 16px;}
        
        .alert-warning {
            background-color: rgba(245, 158, 11, 0.1);border: 1px solid rgba(245, 158, 11, 0.3);color: #92400e;border-radius: 8px;padding: 16px;}
        
        .alert-error {
            background-color: rgba(220, 38, 38, 0.1);border: 1px solid rgba(220, 38, 38, 0.3);color: #991b1b;border-radius: 8px;padding: 16px;}

        /* Animaciones sofisticadas de entrada */
        @keyframes fadeInUp {
            from {
                opacity: 0;transform: translateY(30px);}
            to {
                opacity: 1;transform: translateY(0);}
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;transform: translateX(-30px);}
            to {
                opacity: 1;transform: translateX(0);}
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;transform: translateX(30px);}
            to {
                opacity: 1;transform: translateX(0);}
        }

        @keyframes scaleIn {
            from {
                opacity: 0;transform: scale(0.9);}
            to {
                opacity: 1;transform: scale(1);}
        }

        @keyframes slideInUp {
            from {
                opacity: 0;transform: translateY(50px);}
            to {
                opacity: 1;transform: translateY(0);}
        }

        .animate-fade-in-up {
            opacity: 0;transform: translateY(30px);transition: all 0.6s ease-out;}

        .animate-fade-in-up.animate-scroll-in {
            opacity: 1;transform: translateY(0);}

        .animate-fade-in-left {
            opacity: 0;transform: translateX(-30px);transition: all 0.6s ease-out;}

        .animate-fade-in-left.animate-scroll-in {
            opacity: 1;transform: translateX(0);}

        .animate-fade-in-right {
            opacity: 0;transform: translateX(30px);transition: all 0.6s ease-out;}

        .animate-fade-in-right.animate-scroll-in {
            opacity: 1;transform: translateX(0);}

        .animate-scale-in {
            opacity: 0;transform: scale(0.9);transition: all 0.5s ease-out;}

        .animate-scale-in.animate-scroll-in {
            opacity: 1;transform: scale(1);}

        .animate-slide-in-up {
            opacity: 0;transform: translateY(50px);transition: all 0.7s ease-out;}

        .animate-slide-in-up.animate-scroll-in {
            opacity: 1;transform: translateY(0);}

        /* Animaciones con delay para secuencia */
        .animate-delay-100 { animation-delay: 0.1s; }
        .animate-delay-200 { animation-delay: 0.2s; }
        .animate-delay-300 { animation-delay: 0.3s; }
        .animate-delay-400 { animation-delay: 0.4s; }
        .animate-delay-500 { animation-delay: 0.5s; }
        .animate-delay-600 { animation-delay: 0.6s; }
        .animate-delay-700 { animation-delay: 0.7s; }

        /* Mobile menu styles */
        .nav-mobile-menu {
            display: none;background-color: var(--color-card-bg);border: 1px solid var(--color-border);border-radius: 8px;margin-top: 16px;padding: 16px;box-shadow: 0 4px 6px var(--color-shadow);}

        .nav-mobile-item {
            display: block;padding: 8px 0;color: var(--color-text-secondary);text-decoration: none;font-weight: 500;transition: all 0.2s ease;border-radius: 4px;padding-left: 12px;padding-right: 12px;}

        .nav-mobile-item:hover {
            color: var(--color-primary);background-color: var(--color-surface);}

        .nav-mobile-item.active {
            color: var(--color-primary);background-color: rgba(59, 130, 246, 0.1);font-weight: 600;}

        .nav-mobile-divider {
            border-top: 1px solid var(--color-border);margin: 16px 0;padding-top: 16px;}

        .nav-mobile-user {
            background-color: var(--color-surface);border-radius: 8px;padding: 12px;margin-bottom: 12px;}

        .nav-mobile-user p:first-child {
            color: var(--color-text-primary);font-weight: 600;}

        .nav-mobile-user p:last-child {
            color: var(--color-text-secondary);font-size: 0.75rem;}

        .nav-mobile-danger {
            color: var(--color-danger) !important;}

        .nav-mobile-danger:hover {
            background-color: rgba(239, 68, 68, 0.1) !important;}

        /* Hero Card Styles - Theme Compatible */
        .hero-card {
            background: var(--color-card-bg);backdrop-filter: blur(10px);border: 1px solid var(--color-border);border-radius: 12px;padding: 2rem;box-shadow: 0 8px 25px var(--color-shadow);transition: all 0.3s ease;}

        .hero-card:hover {
            transform: translateY(-2px);box-shadow: 0 12px 35px var(--color-shadow);}

        .hero-card-icon-bg {
            background: var(--color-primary);opacity: 0.1;}

        .hero-card-icon {
            color: var(--color-primary);}

        .hero-card-title {
            color: var(--color-text-primary);}

        .hero-card-text {
            color: var(--color-text-secondary);}

        /* Animaciones del Hero Section */
        .animate-hero-title {
            opacity: 0;transform: translateY(-20px);animation: heroFadeInUp 0.8s ease-out 0.2s forwards;}

        .animate-hero-line {
            opacity: 0;transform: scaleX(0);animation: heroLineGrow 0.6s ease-out 0.6s forwards;}

        .animate-hero-subtitle {
            opacity: 0;transform: translateY(20px);animation: heroFadeInUp 0.8s ease-out 0.8s forwards;}

        .animate-hero-description {
            opacity: 0;transform: translateY(20px);animation: heroFadeInUp 0.8s ease-out 1.0s forwards;}

        .animate-hero-button-1 {
            opacity: 0;transform: translateY(20px);animation: heroFadeInUp 0.6s ease-out 1.2s forwards;}

        .animate-hero-button-2 {
            opacity: 0;transform: translateY(20px);animation: heroFadeInUp 0.6s ease-out 1.4s forwards;}

        .animate-hero-metrics {
            opacity: 0;transform: translateY(30px);animation: heroFadeInUp 0.8s ease-out 1.6s forwards;}

        @keyframes heroFadeInUp {
            from {
                opacity: 0;transform: translateY(30px);}
            to {
                opacity: 1;transform: translateY(0);}
        }

        @keyframes heroLineGrow {
            from {
                opacity: 0;transform: scaleX(0);}
            to {
                opacity: 1;transform: scaleX(1);}
        }

        /* Responsive mejorado */
        @media (max-width: 768px) {
            .chatbot-sidebar {
                width: 100%;height: 50vh;right: 0;bottom: 0;border-radius: 16px 16px 0 0;}

            .chatbot-trigger {
                right: 16px;bottom: 16px;width: 56px;height: 56px;}

            .hero-card {
                padding: 1.5rem;}

            .animate-hero-title,
            .animate-hero-subtitle,
            .animate-hero-description {
                transform: translateY(0);animation: heroFadeIn 0.8s ease-out forwards;}

            .animate-hero-line {
                transform: scaleX(0);animation: heroLineGrow 0.6s ease-out 0.4s forwards;}
        }

        @keyframes heroFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>

    <!-- Fuentes profesionales -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
</head>

<body class="font-primary antialiased" style="background-color: var(--color-background); color: var(--color-text-primary);" data-usuario-id="{{ session.get('usuario_id', '') }}">
    <!-- Navigation -->
    <nav class="nav-bg fixed w-full z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <a href="/" class="nav-brand">Econova</a>
                </div>

                <div class="hidden lg:flex items-center">
                    {% set current_path = request.path %}

                    <!-- Navegación Principal -->
                    <div class="flex items-center space-x-1 mr-6">
                        {% if current_path == '/' %}
                        <a href="#caracteristicas" class="nav-link">Características</a>
                        <a href="#simulacion" class="nav-link">Simulaciones</a>
                        {% endif %}

                        {% if current_path not in ['/', '/chatbot', '/benchmarking', '/gamification', '/simulacion', '/prestamo', '/ahorro-inversion'] %}
                        <a href="/" class="nav-link">Inicio</a>
                        {% endif %}
                    </div>

                    <!-- Herramientas Financieras - Dropdown -->
                    <div class="relative mr-6">
                        <button id="herramientas-menu-button" class="nav-link flex items-center">
                            <i class="fas fa-tools mr-1"></i>Herramientas
                            <i class="fas fa-chevron-down text-xs ml-1"></i>
                        </button>

                        <!-- Dropdown Menu -->
                        <div id="herramientas-dropdown" class="nav-dropdown">
                            <div class="nav-dropdown-header">
                                <p class="text-sm font-medium">Herramientas Financieras</p>
                                <p class="text-xs">Accede a nuestras calculadoras y asistentes</p>
                            </div>
                            <a href="/simulacion" class="nav-dropdown-item {% if current_path == '/simulacion' %}active{% endif %}">
                                <i class="fas fa-calculator mr-2"></i>Simulación Financiera
                                <span class="text-xs text-gray-400 ml-auto">VAN, TIR, WACC</span>
                            </a>
                            <a href="/chatbot" class="nav-dropdown-item {% if current_path == '/chatbot' %}active{% endif %}">
                                <i class="fas fa-robot mr-2"></i>Chatbot IA
                                <span class="text-xs text-gray-400 ml-auto">Asistente inteligente</span>
                            </a>
                            <a href="/benchmarking" class="nav-dropdown-item {% if current_path == '/benchmarking' %}active{% endif %}">
                                <i class="fas fa-chart-bar mr-2"></i>Benchmarking
                                <span class="text-xs text-gray-400 ml-auto">Comparativas</span>
                            </a>
                        </div>
                    </div>

                    <!-- Servicios Avanzados -->
                    <div class="flex items-center space-x-1 mr-6">
                        <a href="/gamification" class="nav-link {% if current_path == '/gamification' %}active{% endif %}" title="Sistema de Recompensas">
                            <i class="fas fa-trophy mr-1"></i>Gamificación
                        </a>
                        <a href="/prestamo" class="nav-link {% if current_path == '/prestamo' %}active{% endif %}" title="Análisis de Préstamos">
                            <i class="fas fa-file-invoice-dollar mr-1"></i>Préstamos
                        </a>
                        <a href="/ahorro-inversion" class="nav-link {% if current_path == '/ahorro-inversion' %}active{% endif %}" title="Planificación de Ahorro">
                            <i class="fas fa-piggy-bank mr-1"></i>Ahorro
                        </a>
                    </div>

                    {% if session.usuario_id %}
                    <!-- User Menu -->
                    <div class="relative">
                        <button id="user-menu-button" class="nav-user-btn">
                            {% if session.usuario_foto_perfil %}
                            <img src="{{ url_for('static', filename='uploads/profile_pictures/' + session.usuario_foto_perfil) }}" alt="Foto de perfil" class="w-8 h-8 rounded-full object-cover">
                            {% else %}
                            <div class="nav-user-avatar">
                                <span class="text-white text-sm font-semibold">{{ session.usuario_nombre[0] if session.usuario_nombre else 'U' }}</span>
                            </div>
                            {% endif %}
                            <span class="font-medium">{{ session.usuario_nombre.split(' ')[0] if session.usuario_nombre else 'Usuario' }}</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>

                        <!-- Dropdown Menu -->
                        <div id="user-dropdown" class="nav-dropdown">
                            <div class="nav-dropdown-header">
                                <p class="text-sm font-medium">{{ session.usuario_nombre }}</p>
                                <p class="text-xs">{{ session.usuario_email }}</p>
                            </div>
                            <a href="/dashboard" class="nav-dropdown-item">
                                <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                            </a>
                            <a href="/perfil" class="nav-dropdown-item">
                                <i class="fas fa-user mr-2"></i>Mi Perfil
                            </a>
                            <a href="/resultados" class="nav-dropdown-item">
                                <i class="fas fa-chart-line mr-2"></i>Mis Resultados
                            </a>
                            <a href="/simulacion" class="nav-dropdown-item">
                                <i class="fas fa-plus-circle mr-2"></i>Nueva Simulación
                            </a>
                            <div class="nav-dropdown-divider"></div>
                            <a href="/logout" class="nav-dropdown-item nav-dropdown-danger">
                                <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión
                            </a>
                        </div>
                    </div>

                    <!-- Theme Toggle Button (Sun/Moon) -->
                    <button id="theme-toggle-btn" class="nav-theme-btn" title="Cambiar tema">
                        <i id="theme-icon" class="fas fa-sun"></i>
                    </button>
                    {% else %}
                    <!-- Guest Menu -->
                    <a href="/login" class="nav-login-btn">
                        <i class="fas fa-sign-in-alt mr-1"></i>Iniciar Sesión
                    </a>
                    <a href="/registro" class="nav-register-btn">Registrarse</a>
                    {% endif %}
                </div>

                <!-- Mobile menu button -->
                <div class="lg:hidden">
                    <button id="mobile-menu-button" class="nav-mobile-btn">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- Mobile menu -->
            <div id="mobile-menu" class="nav-mobile-menu">
                {% set current_path = request.path %}
                {% if current_path == '/' %}
                <a href="#caracteristicas" class="nav-mobile-item">Características</a>
                <a href="#simulacion" class="nav-mobile-item">Simulaciones</a>
                {% endif %}

                <!-- Páginas principales siempre visibles en móvil -->
                <a href="/simulacion" class="nav-mobile-item {% if current_path == '/simulacion' %}active{% endif %}">Simulación</a>
                <a href="/chatbot" class="nav-mobile-item {% if current_path == '/chatbot' %}active{% endif %}">Chatbot</a>
                <a href="/benchmarking" class="nav-mobile-item {% if current_path == '/benchmarking' %}active{% endif %}">Benchmarking</a>
                <a href="/gamification" class="nav-mobile-item {% if current_path == '/gamification' %}active{% endif %}"><i class="fas fa-trophy mr-1"></i>Gamificación</a>
                <a href="/prestamo" class="nav-mobile-item {% if current_path == '/prestamo' %}active{% endif %}"><i class="fas fa-file-invoice-dollar mr-1"></i>Préstamos</a>
                <a href="/ahorro-inversion" class="nav-mobile-item {% if current_path == '/ahorro-inversion' %}active{% endif %}"><i class="fas fa-piggy-bank mr-1"></i>Ahorro</a>

                {% if current_path not in ['/', '/chatbot', '/benchmarking', '/gamification', '/simulacion', '/prestamo', '/ahorro-inversion'] %}
                <a href="/" class="nav-mobile-item">Inicio</a>
                {% endif %}

                {% if session.usuario_id %}
                <!-- User Mobile Menu -->
                <div class="nav-mobile-divider">
                    <div class="nav-mobile-user">
                        <p class="text-sm font-medium">{{ session.usuario_nombre.split(' ')[0] if session.usuario_nombre else 'Usuario' }}</p>
                        <p class="text-xs">{{ session.usuario_email }}</p>
                    </div>
                    <a href="/dashboard" class="nav-mobile-item">
                        <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                    </a>
                    <a href="/perfil" class="nav-mobile-item">
                        <i class="fas fa-user mr-2"></i>Mi Perfil
                    </a>
                    <a href="/resultados" class="nav-mobile-item">
                        <i class="fas fa-chart-line mr-2"></i>Mis Resultados
                    </a>
                    <a href="/simulacion" class="nav-mobile-item">
                        <i class="fas fa-plus-circle mr-2"></i>Nueva Simulación
                    </a>
                    <a href="/logout" class="nav-mobile-item nav-mobile-danger">
                        <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión
                    </a>
                </div>
                {% else %}
                <!-- Guest Mobile Menu -->
                <a href="/login" class="nav-login-btn">
                    <i class="fas fa-sign-in-alt mr-1"></i>Iniciar Sesión
                </a>
                <a href="/registro" class="nav-register-btn">Registrarse</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-16">
        {% block content %}{% endblock %}
    </main>

    <!-- Scripts -->
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function () {
            const menu = document.getElementById('mobile-menu');menu.classList.toggle('hidden');});// Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();const target = document.querySelector(this.getAttribute('href'));if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });}
            });});// Add animation to cards on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fade-in');}
            });}, observerOptions);// Observe all feature cards
        document.querySelectorAll('.card-hover').forEach(card => {
            observer.observe(card);});// Animated Counters
        function animateCounters() {
            const counters = document.querySelectorAll('[data-target]');const speed = 200; // The lower the slower

            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');const count = +counter.innerText;const increment = target / speed;if (count < target) {
                    counter.innerText = Math.ceil(count + increment);setTimeout(() => animateCounters(), 1);} else {
                    counter.innerText = target.toLocaleString();}
            });}

        // Trigger counters when they come into view
        const counterObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateCounters();counterObserver.unobserve(entry.target);}
            });}, { threshold: 0.5 });// Observe counter section
        const counterSection = document.querySelector('.py-20.bg-white .grid.md\\:grid-cols-4');if (counterSection) {
            counterObserver.observe(counterSection);}

        // Welcome Modal Functionality
        function showWelcomeModal() {
            const modal = document.getElementById('welcome-modal');if (modal) {
                // Show modal with animation
                setTimeout(() => {
                    modal.classList.remove('opacity-0', 'pointer-events-none');modal.classList.add('opacity-100', 'pointer-events-auto');modal.querySelector('.transform').classList.remove('scale-95');modal.querySelector('.transform').classList.add('scale-100');}, 1500); // Show after 1.5 seconds for better UX
            }
        }

        function hideWelcomeModal() {
            const modal = document.getElementById('welcome-modal');if (modal) {
                modal.classList.remove('opacity-100', 'pointer-events-auto');modal.classList.add('opacity-0', 'pointer-events-none');modal.querySelector('.transform').classList.remove('scale-100');modal.querySelector('.transform').classList.add('scale-95');}
        }

        // Dropdown functionality
        function initDropdowns() {
            // Herramientas dropdown
            const herramientasBtn = document.getElementById('herramientas-menu-button');const herramientasMenu = document.getElementById('herramientas-dropdown');if (herramientasBtn && herramientasMenu) {
                // Ensure dropdown starts hidden
                herramientasMenu.classList.add('hidden');herramientasBtn.addEventListener('click', function(e) {
                    e.preventDefault();e.stopPropagation();// Toggle menu
                    if (herramientasMenu.classList.contains('hidden')) {
                        herramientasMenu.classList.remove('hidden');herramientasMenu.style.display = 'block';} else {
                        herramientasMenu.classList.add('hidden');herramientasMenu.style.display = 'none';}
                });// Close when clicking outside
                document.addEventListener('click', function(e) {
                    if (!herramientasBtn.contains(e.target) && !herramientasMenu.contains(e.target)) {
                        herramientasMenu.classList.add('hidden');herramientasMenu.style.display = 'none';}
                });}

            // User dropdown
            const userBtn = document.getElementById('user-menu-button');const userMenu = document.getElementById('user-dropdown');if (userBtn && userMenu) {
                // Ensure dropdown starts hidden
                userMenu.classList.add('hidden');userBtn.addEventListener('click', function(e) {
                    e.preventDefault();e.stopPropagation();// Toggle menu
                    if (userMenu.classList.contains('hidden')) {
                        userMenu.classList.remove('hidden');userMenu.style.display = 'block';} else {
                        userMenu.classList.add('hidden');userMenu.style.display = 'none';}
                });// Close when clicking outside
                document.addEventListener('click', function(e) {
                    if (!userBtn.contains(e.target) && !userMenu.contains(e.target)) {
                        userMenu.classList.add('hidden');userMenu.style.display = 'none';}
                });}

            // Close all dropdowns on Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // Close herramientas dropdown
                    if (herramientasMenu) {
                        herramientasMenu.classList.add('hidden');herramientasMenu.style.display = 'none';}
                    // Close user dropdown
                    if (userMenu) {
                        userMenu.classList.add('hidden');userMenu.style.display = 'none';}
                }
            });}

        // Initialize dropdowns after a short delay to ensure DOM is ready
        setTimeout(initDropdowns, 10);// Modal event listeners
        document.addEventListener('DOMContentLoaded', function () {
            // Show modal on page load (only once per session)
            if (!sessionStorage.getItem('welcomeModalShown')) {
                showWelcomeModal();sessionStorage.setItem('welcomeModalShown', 'true');}

            // Close modal events
            const closeBtn = document.getElementById('close-modal');if (closeBtn) {
                closeBtn.addEventListener('click', hideWelcomeModal);}

            // Close modal when clicking outside
            const modal = document.getElementById('welcome-modal');if (modal) {
                modal.addEventListener('click', function (e) {
                    if (e.target === modal) {
                        hideWelcomeModal();}
                });}

            // Close modal on Escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    hideWelcomeModal();}
            });});</script>

    <!-- Custom CSS animations -->
    <style>
        @keyframes fade-in {
            from {
                opacity: 0;transform: translateY(20px);}

            to {
                opacity: 1;transform: translateY(0);}
        }

        .animate-fade-in {
            animation: fade-in 0.6s ease-out forwards;}
    </style>

    <!-- Elementos visuales modernos -->
    <!-- Theme switcher removed - using simple sun/moon toggle only -->

    <!-- Avatar del chatbot -->
    <div id="chatbot-avatar" style="display: none;">
        <div class="avatar-container">
            <div class="avatar-face">
                <div class="avatar-eye left"></div>
                <div class="avatar-eye right"></div>
                <div class="avatar-mouth"></div>
            </div>
            <div class="avatar-notification" style="display: none;"></div>
        </div>
    </div>

    <!-- Contenedor de mensajes contextuales -->
    <div id="contextual-messages-container" class="contextual-messages-container top-right"></div>

    <!-- Scripts de elementos visuales - cargados condicionalmente -->
    <script src="{{ url_for('static', filename='js/sistema/theme.js') }}"></script>
    {% if request.path in ['/simulacion', '/benchmarking'] %}
    <script src="{{ url_for('static', filename='js/sistema/contextual_message.js') }}"></script>
    {% endif %}
    {% if request.path == '/chatbot' %}
    <!-- Chatbot System - Versión Mejorada 2.0 -->
    <script src="{{ url_for('static', filename='js/chatbot_utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot/chatbot-core.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot/chatbot-voice.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot/chatbot-integration.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot/chatbot-init.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot_main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot_avatar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot_messaging.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot_welcome.js') }}"></script>
    <script src="{{ url_for('static', filename='js/econova_robot_3d.js') }}"></script>
    {% endif %}

    <!-- Inicialización de elementos visuales -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;// Inicializar sistema de temas (siempre disponible)
            if (window.themeManager) {
                window.themeManager.init();}

            // Inicializar elementos específicos de página
            if (currentPath === '/chatbot') {
                // Chatbot page elements
                if (window.contextualMessages) window.contextualMessages.init();if (window.chatbotAvatar) window.chatbotAvatar.init();if (window.econovaRobot && document.getElementById('chatbot-robot')) {
                    window.econovaRobot.init('chatbot-robot');}
            } else if (['/simulacion', '/benchmarking'].includes(currentPath)) {
                // Simulation/Benchmarking pages
                if (window.contextualMessages) window.contextualMessages.init();}
        });</script>

    <!-- Simple Sun/Moon Theme Toggle -->
    <script>
        // Simple light/dark theme toggle with sun/moon icons
        function initThemeToggle() {
            const themeBtn = document.getElementById('theme-toggle-btn');const themeIcon = document.getElementById('theme-icon');if (!themeBtn || !themeIcon) {
                
                return;}

            // Function to update icon based on current theme
            function updateIcon() {
                const currentTheme = document.body.className.includes('theme-dark') ? 'dark' : 'light';if (currentTheme === 'dark') {
                    themeIcon.className = 'fas fa-moon text-blue-400';themeBtn.title = 'Cambiar a tema claro';} else {
                    themeIcon.className = 'fas fa-sun text-yellow-500';themeBtn.title = 'Cambiar a tema oscuro';}
            }

            // Handle button click - toggle between light and dark
            themeBtn.addEventListener('click', function(e) {
                e.preventDefault();e.stopPropagation();const currentTheme = document.body.className.includes('theme-dark') ? 'dark' : 'light';const newTheme = currentTheme === 'dark' ? 'light' : 'dark';// Use theme manager if available
                if (window.themeManager && window.themeManager.applyTheme) {
                    window.themeManager.applyTheme(newTheme);} else if (window.switchTheme) {
                    window.switchTheme(newTheme);}

                // Update icon after a short delay to let theme change take effect
                setTimeout(updateIcon, 50);});// Initial icon update
            updateIcon();// Listen for theme changes to update icon
            document.addEventListener('themeChanged', updateIcon);}

        // Initialize immediately
        initThemeToggle();</script>

    <!-- Extra scripts block for page-specific scripts -->
    {% block extra_scripts %}{% endblock %}
</body>

</html>
